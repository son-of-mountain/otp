<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Connexion OTP</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; padding-top: 50px; }
        .container { border: 1px solid #ccc; padding: 20px; width: 300px; text-align: center; }
        input { width: 90%; padding: 10px; margin: 10px 0; }
        button { width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #msg { margin-top: 10px; color: red; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <h2>üîê Connexion S√©curis√©e</h2>

    <div id="step-phone">
        <input type="text" id="phoneInput" placeholder="Votre num√©ro (ex: 0612345678)">
        <button onclick="sendOtp()">Recevoir le Code</button>
    </div>

    <div id="step-otp" class="hidden">
        <p>Code envoy√© au <b id="displayPhone"></b></p>
        <input type="text" id="otpInput" placeholder="Entrez le code re√ßu">
        <button onclick="verifyOtp()">Valider</button>
    </div>

    <p id="msg"></p>
</div>

<script>
    // URL de ton Backend via Nginx
    const API_URL = "http://localhost/api/auth";

    async function sendOtp() {
        const phone = document.getElementById('phoneInput').value;
        const msg = document.getElementById('msg');
        
        msg.textContent = "Envoi en cours...";
        
        try {
            const response = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone: phone })
            });

            if (response.ok) {
                document.getElementById('step-phone').classList.add('hidden');
                document.getElementById('step-otp').classList.remove('hidden');
                document.getElementById('displayPhone').textContent = phone;
                msg.textContent = "";
            } else {
                const text = await response.text();
                msg.textContent = "Erreur : " + text;
            }
        } catch (error) {
            msg.textContent = "Erreur de connexion au serveur.";
        }
    }

    async function verifyOtp() {
        const phone = document.getElementById('phoneInput').value;
        const code = document.getElementById('otpInput').value;
        
        try {
            const response = await fetch(`${API_URL}/verify`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ phone: phone, code: code })
            });

            if (response.ok) {
                // Consigne : Page de validation
                window.location.href = "success.html";
            } else {
                // Consigne : Page d'erreur
                window.location.href = "error.html";
            }
        } catch (error) {
            alert("Erreur technique");
        }
    }
</script>

</body>
</html>
